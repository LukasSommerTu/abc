
Inter-type declarations (ITDs) provide a powerful yet simple modularisation
mechanism. The possibility to extend existing classes modularly without
ahead of time planning is not only useful to separate different concerns
but also extremely convenient for modular extensibility when software
evolves.

A common critisizm of ITDs is their global scope which arguably leads to
poor information hiding and require global analysis during compilation.
Another disadvantage to more traditional extensibility patterns, e.g.,
visitors, is that the class hierarchy is destructively updated, preventing
multiple versions of a system with different sets of ITDs applied.
These problems exists to a certain extent in plain Java programs as well
and there has been a wealth of recent work on module systems to improve on
status quo. 

The emerging support for modules in Java 7 enhances information hiding and
extended module proposals such as Srniza gives hope for simulatneous
deployment of multiple versions of the same library in different modules.

import-export for information hiding -> package is too fine grained which
often leads to global scope. modules allow more precise control of
access control which leads to improved information hiding.

instantiation for multiple versions of a module (iJAM)-> 

ITDs are global in their nature which makes local
reasoning somewhat difficult, and as an extensibility mechanism they can be
improved by enabling deployment of multiple versions of libraries, 
each woven a with different set of ITDs.


Previous work show how aspects can be improved using modules for point-cut
and advice.
Aspects don't work very well without modules, due to global scope, and
implicit dependencies.
In this paper we present a module system that supports inter-type
declarations and improve their use when extending a system in a modular
fashion.

We believe that such benefits are even more important for a system with
inter-type declarations. 


%Aspect instantiation has always been a sticky subject (e.g. doubly applied
%pointcuts in AspectJ abstract aspects)


In our previous work we explain how to use ITDs as one of the main
modularisation mechanisms when building extensible compilers. Our current
work involves using the same techniques to generate IDEs for a wide range
of dialects of Java. In such an IDE we may for instance want to use numerous variants of the
same frontend that slightly differ to support different dialects. We also
want to use a pure frontend for error checking while a backend is also
needed to support code generation.
That work highlights some defiencies to ITDs from an extensibility point of
view compared to the more traditional use of visitors.

Traditionally done using visitors. Advantages of inter-type declarations:
no ahead of time planning, add state, no boiler-plate code, less error
prone since you don't have to adhere to framework conventions to enable dispatch.

Severe drawbacks from extensibility point of view:
Destructive update of the class hierarchy. The base version and the
extended version can not co-exist. This is the main motivation for our
work. Requires a global analysis for type checking, name binding, and
compilation.

We have implemented the proposed module system as an extension to the
JastAdd Extensible Java Compiler which contains support for amongst others
ITDs. 
To evaluate the module system we performed a case study where the above
mentioned extensible Java compiler built using ITDs was refactored to use
the proposed module system.
The proposed module system solves some of these problems completely in an
elegant fashion, while the burden of other problems are slightly lowered.

These are the main contributions of this paper:
\begin{itemize}
\item The design of a module system for ITDs that improves information
hiding and extensibility.
\item An implementation as a modular extension to the JastAdd Extensible
Java compiler.
\item A case study where extensible Java compiler is retrofitted to use the
proposed module system.
\end{itemize}

The rest of this paper is structured as follows: In
Section~\ref{section:itdvisitors} we present a detailed example that
highlight the merits and deficiencies of ITDs compared to a visitor based
approach. A module system that shows how that example can be improved is
presented in Section~\ref{section:jastaddmodules} and we present a case
study where an extensible Java compiler is retrofitted to use that module
system in Section~\ref{section:casestudy} where we also discuss 
the advantages it brings compared to the original impelementation. A
brief overview of the module system implementation is presented in
Section~\ref{section:implementation} and we discuss related work in
Section~\ref{section:related} and conclude in
Section~\ref{section:conclusions}.

