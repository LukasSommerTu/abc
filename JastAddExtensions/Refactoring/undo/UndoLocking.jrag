aspect UndoLocking {

	// Locked Method Access
	
	refine LockedMethodAccess private SavedMethodDecl MethodAccess.setTargetMethod(SavedMethodDecl smd) {
		Program root = (Program) programRootParentFromField();
		if (root != null && root.isRecordingUndo()) {
			final SavedMethodDecl saved = targetMethod;
			root.addUndoAction(new ASTModification() {
				
				@Override
				public void undo() {
					targetMethod = saved;
				}
			});
		}
		return refined(smd);
	}

	refine LockedMethodAccess private MethodDecl ElementValuePair.setTargetMethod(MethodDecl md) {
		Program root = (Program) programRootParentFromField();
		if (root != null && root.isRecordingUndo()) {
			final MethodDecl saved = targetMethod;
			root.addUndoAction(new ASTModification() {
				
				@Override
				public void undo() {
					targetMethod = saved;
				}
			});
		}
		return refined(md);
	}
	
	
	// Locked Package Access
	
	refine LockedPackageAccess private void PackageAccess.setTargetPackage(PackageDecl pd) {
		Program root = (Program) programRootParentFromField();
		if (root != null && root.isRecordingUndo()) {
			final PackageDecl saved = targetPackage;
			root.addUndoAction(new ASTModification() {
				
				@Override
				public void undo() {
					targetPackage = saved;
				}
			});
		}
		refined(pd);
	}
	
	
	// LockedVariableAccess
	refine LockedVariableAccess private void VarAccess.setTargetVariable(Variable var) {
		Program root = (Program) programRootParentFromField();
		if (root != null && root.isRecordingUndo()) {
			final Variable saved = targetVariable;
			root.addUndoAction(new ASTModification() {
				
				@Override
				public void undo() {
					targetVariable = saved;
				}
			});
		}
		refined(var);
	}
	
	
	// LockedTypeAccess
	refine LockedTypeAccess private void CompilationUnit.setLocked(boolean value) {
		Program root = (Program) programRootParentFromField();
		if (root != null && root.isRecordingUndo()) {
			final boolean saved = locked;
			root.addUndoAction(new ASTModification() {
				
				@Override
				public void undo() {
					locked = saved;
				}
			});
		}
		refined(value);
	}
	refine LockedTypeAccess private void TypeAccess.setTargetType(TypeDecl td) {
		Program root = (Program) programRootParentFromField();
		if (root != null && root.isRecordingUndo()) {
			final TypeDecl saved = targetType;
			root.addUndoAction(new ASTModification() {
				
				@Override
				public void undo() {
					targetType = saved;
				}
			});
		}
		refined(td);
	}
	
	// LockedConstructor
	refine LockedConstructor private void ConstructorDecl.setLocked(boolean value) {
		Program root = (Program) programRootParentFromField();
		if (root != null && root.isRecordingUndo()) {
			final boolean saved = locked;
			root.addUndoAction(new ASTModification() {
				
				@Override
				public void undo() {
					locked = saved;
				}
			});
		}
		refined(value);
	}
	
	// LockedSingleStaticImportDecl
	refine LockedSingleStaticImportDecl private void SingleStaticImportDecl.setLocked(boolean value) {
		Program root = (Program) programRootParentFromField();
		if (root != null && root.isRecordingUndo()) {
			final boolean saved = locked;
			root.addUndoAction(new ASTModification() {
				
				@Override
				public void undo() {
					locked = saved;
				}
			});
		}
		refined(value);
	}
	
	
	
	
	
	
	
	
}